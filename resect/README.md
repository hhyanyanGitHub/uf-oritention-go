核心原理解析：空间后方交会

1. 目标是什么？
   假设无人机拍了一张照片，照片里有几个地面特征点（如控制桩），我们已知这些点在地面上的真实 3D 坐标
   (
   X
   ,
   Y
   ,
   Z
   )
   (X,Y,Z)
   ，也知道它们在照片上的 2D 像素坐标
   (
   x
   ,
   y
   )
   (x,y)
   。
   我们的目标是：反推相机在按下快门那一瞬间的空间位置
   (
   X
   L
   ,
   Y
   L
   ,
   Z
   L
   )
   (X
   L
   ​
   ,Y
   L
   ​
   ,Z
   L
   ​
   )
   和 姿态角
   (
   ω
   ,
   ϕ
   ,
   κ
   )
   (ω,ϕ,κ)
   （共 6 个未知数）。
2. 数学模型：共线条件方程 (Collinearity Equations)
   这是整个摄影测量学的心脏。它的物理意义非常直观：地面的点、相机的镜头中心、照片上的成像点，这三点必须在同一条直线上。
   公式为：
   x
   =
   −
   f
   m
   11
   (
   X
   −
   X
   L
   )

- m
  12
  (
  Y
  −
  Y
  L
  )
- m
  13
  (
  Z
  −
  Z
  L
  )
  m
  31
  (
  X
  −
  X
  L
  )
- m
  32
  (
  Y
  −
  Y
  L
  )
- m
  33
  (
  Z
  −
  Z
  L
  )
  x=−f
  m
  31
  ​
  (X−X
  L
  ​
  )+m
  32
  ​
  (Y−Y
  L
  ​
  )+m
  33
  ​
  (Z−Z
  L
  ​
  )
  m
  11
  ​
  (X−X
  L
  ​
  )+m
  12
  ​
  (Y−Y
  L
  ​
  )+m
  13
  ​
  (Z−Z
  L
  ​
  )
  ​

# y

−
f
m
21
(
X
−
X
L
)

- m
  22
  (
  Y
  −
  Y
  L
  )
- m
  23
  (
  Z
  −
  Z
  L
  )
  m
  31
  (
  X
  −
  X
  L
  )
- m
  32
  (
  Y
  −
  Y
  L
  )
- m
  33
  (
  Z
  −
  Z
  L
  )
  y=−f
  m
  31
  ​
  (X−X
  L
  ​
  )+m
  32
  ​
  (Y−Y
  L
  ​
  )+m
  33
  ​
  (Z−Z
  L
  ​
  )
  m
  21
  ​
  (X−X
  L
  ​
  )+m
  22
  ​
  (Y−Y
  L
  ​
  )+m
  23
  ​
  (Z−Z
  L
  ​
  )
  ​

(注：公式里的
m
11
m
11
​

到
m
33
m
33
​

是由
ω
,
ϕ
,
κ
ω,ϕ,κ
算出的 3x3 旋转矩阵元素；
f
f
是焦距) 3. 最小二乘法平差原理
由于这个方程是非线性的（包含了正余弦和分式），我们不能直接解，必须做泰勒级数展开（线性化）：
L
m
e
a
s
=
F
(
X
0
)

- J
  ⋅
  Δ
  L
  meas
  ​
  =F(X
  0
  ​
  )+J⋅Δ
  L
  m
  e
  a
  s
  L
  meas
  ​

：相片上实际量到的坐标
(
x
,
y
)
(x,y)
F
(
X
0
)
F(X
0
​
)
：用猜的初始参数算出来的理论坐标
J
J
：雅可比矩阵（偏导数，即 C 代码里的 bdot）
Δ
Δ
：我们要寻找的 6 个参数的修正量（改正数）
化简为误差方程式：
J
⋅
Δ
=
ϵ
J⋅Δ=ϵ
（其中
ϵ
=
L
m
e
a
s
−
F
(
X
0
)
ϵ=L
meas
​
−F(X
0
​
)
）
为了求解，我们在两边同乘
J
T
J
T

构造法方程：
(
J
T
J
)
⋅
Δ
=
J
T
ϵ
(J
T
J)⋅Δ=J
T
ϵ

这里，
J
T
J
J
T
J
就是大名鼎鼎的法方程矩阵
N
N
。算出
Δ
Δ
后，加到初始值上，不断循环迭代，直到
Δ
Δ
趋近于 0，就是收敛了！
