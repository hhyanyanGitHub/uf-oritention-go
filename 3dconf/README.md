终章原理解析：将虚拟锚定于现实（连接 GIS 的桥梁）

1. 目标是什么？
   在上一个程序（相对定向）里，我们建好了一个 3D 模型。但这个模型是“相对”的——它的比例尺可能不对（树可能只有 1 毫米高），方向是歪的（北方朝下），且原点悬浮在半空中。
   现在，我们有了几个控制点（如 RTK 打下的地标桩），既知道它们在“相对模型”里的坐标，也知道它们在地球上的“真实 GPS/高斯投影”坐标。
   我们需要算出 7 个终极转换参数，把整个相对模型“严丝合缝”地扣到地球上！
2. 数学模型：七参数赫尔默特变换 (Helmert Transformation)
   公式非常优雅，这也是现代所有点云配准（如 LiDAR 数据对齐）、GIS 坐标系转换的底层公式：
   [
   X
   Y
   Z
   ]
   真实
   =
   S
   ⋅
   R
   (
   ω
   ,
   ϕ
   ,
   κ
   )
   ⋅
   [
   X
   Y
   Z
   ]
   相对

- [
  T
  X
  T
  Y
  T
  Z
  ]
  ​

X
Y
Z
​

​

真实
​
=S⋅R(ω,ϕ,κ)⋅
​

X
Y
Z
​

​

相对
​

- ​

T
X
​

T
Y
​

T
Z
​

​

​

S
S
：1 个比例尺（Scale），把模型放大到真实大小。
R
R
：3 个旋转角（
ω
,
ϕ
,
κ
ω,ϕ,κ
），把模型转正。
T
T
：3 个平移量（
T
X
,
T
Y
,
T
Z
T
X
​
,T
Y
​
,T
Z
​

），把模型移动到地球的正确经纬度/高程上。
总共 7 个未知数。3. Dewitt 的神级算法（1996）
这个程序最耀眼的不是最小二乘法，而是求初值（InitApprox）。在三维空间中盲猜 3 个旋转角极其容易出错（导致发散）。
本书作者之一 Bon A. Dewitt 在 1996 年发明了这套算法：
遍历所有公共点，寻找**“几何结构最强的三角形”**（也就是高最大的三角形，最接近等边三角形，抗畸变能力最强）。
分别在“相对空间”和“真实空间”算出这个三角形所在平面的法向量。
利用法向量的倾角（Tilt）、方位角（Azimuth）和面内旋角（Swing），直接通过代数推导出完美的初值！这在当年是极具工程实用价值的突破。
